import{_ as n,r as s,c as a,a as e,w as t,f as o,e as p,b as l,o as c}from"./app.82084a0b.js";const r='{"title":"XSS 和 CSRF","description":"","frontmatter":{},"headers":[{"level":2,"title":"XSS","slug":"xss"},{"level":3,"title":"反射型","slug":"反射型"},{"level":3,"title":"存储型","slug":"存储型"},{"level":3,"title":"基于DOM","slug":"基于dom"},{"level":2,"title":"XSS 攻击的防范","slug":"xss-攻击的防范"},{"level":3,"title":"HttpOnly 防止劫取 Cookie","slug":"httponly-防止劫取-cookie"},{"level":3,"title":"输入检查","slug":"输入检查"},{"level":3,"title":"输出检查","slug":"输出检查"},{"level":2,"title":"CSRF","slug":"csrf"},{"level":2,"title":"浏览器的 Cookie 策略","slug":"浏览器的-cookie-策略"},{"level":2,"title":"CSRF 攻击的防范","slug":"csrf-攻击的防范"},{"level":3,"title":"验证码","slug":"验证码"},{"level":3,"title":"Referer Check","slug":"referer-check"},{"level":3,"title":"添加 token 验证","slug":"添加-token-验证"},{"level":2,"title":"总结","slug":"总结"}],"relativePath":"learns/security/xss-and-csrf.md","lastUpdated":1638452551948}',i={},u=o('',10),k=p("div",{class:"language-html line-numbers-mode"},[p("pre",null,[p("code",null,[l("恶意链接的地址指向了 localhost:8001/?q=111&p=222。然后，我再启一个简单的 Node 服务处理恶意链接的请求：\n\nconst http = require('http');\nfunction handleReequest(req, res) {\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.writeHead(200, {'Content-Type': 'text/html; charset=UTF-8'});\n  res.write('"),p("span",{class:"token tag"},[p("span",{class:"token tag"},[p("span",{class:"token punctuation"},"<"),l("script")]),p("span",{class:"token punctuation"},">")]),p("span",{class:"token script"},[p("span",{class:"token language-javascript"},[p("span",{class:"token function"},"alert"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},'"反射型 XSS 攻击"'),p("span",{class:"token punctuation"},")")])]),p("span",{class:"token tag"},[p("span",{class:"token tag"},[p("span",{class:"token punctuation"},"</"),l("script")]),p("span",{class:"token punctuation"},">")]),l("');\n  res.end();\n}\n\nconst server = new http.Server();\nserver.listen(8001, '127.0.0.1');\nserver.on('request', handleReequest);\n\n当用户点击恶意链接时，页面跳转到攻击者预先准备的页面，会发现在攻击者的页面执行了 js 脚本：\n\n这样就产生了反射型 XSS 攻击。攻击者可以注入任意的恶意脚本进行攻击，可能注入恶作剧脚本，或者注入能获取用户隐私数据(如cookie)的脚本，这取决于攻击者的目的。\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br"),p("span",{class:"line-number"},"3"),p("br"),p("span",{class:"line-number"},"4"),p("br"),p("span",{class:"line-number"},"5"),p("br"),p("span",{class:"line-number"},"6"),p("br"),p("span",{class:"line-number"},"7"),p("br"),p("span",{class:"line-number"},"8"),p("br"),p("span",{class:"line-number"},"9"),p("br"),p("span",{class:"line-number"},"10"),p("br"),p("span",{class:"line-number"},"11"),p("br"),p("span",{class:"line-number"},"12"),p("br"),p("span",{class:"line-number"},"13"),p("br"),p("span",{class:"line-number"},"14"),p("br"),p("span",{class:"line-number"},"15"),p("br"),p("span",{class:"line-number"},"16"),p("br"),p("span",{class:"line-number"},"17"),p("br")])],-1),b=p("h3",{id:"存储型",tabindex:"-1"},[l("存储型 "),p("a",{class:"header-anchor",href:"#存储型","aria-hidden":"true"},"#")],-1),d=p("p",null,'存储型 XSS 会把用户输入的数据 "存储" 在服务器端，当浏览器请求数据时，脚本从服务器上传回并执行。这种 XSS 攻击具有很强的稳定性。',-1),m=p("p",null,"比较常见的一个场景是攻击者在社区或论坛上写下一篇包含恶意 JavaScript 代码的文章或评论，文章或评论发表后，所有访问该文章或评论的用户，都会在他们的浏览器中执行这段恶意的 JavaScript 代码。",-1),h=p("p",null,"举一个示例。",-1),g=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token operator"},"<"),l("input type"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"text"'),l(" id"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"input"'),p("span",{class:"token operator"},">"),l("\n"),p("span",{class:"token operator"},"<"),l("button id"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"btn"'),p("span",{class:"token operator"},">"),l("Submit"),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("button"),p("span",{class:"token operator"},">"),l("\n\n"),p("span",{class:"token operator"},"<"),l("script"),p("span",{class:"token operator"},">"),l("\n  "),p("span",{class:"token keyword"},"const"),l(" input "),p("span",{class:"token operator"},"="),l(" document"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"getElementById"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'input'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n  "),p("span",{class:"token keyword"},"const"),l(" btn "),p("span",{class:"token operator"},"="),l(" document"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"getElementById"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'btn'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\n  "),p("span",{class:"token keyword"},"let"),l(" val"),p("span",{class:"token punctuation"},";"),l("\n\n  input"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"addEventListener"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'change'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"("),p("span",{class:"token parameter"},"e"),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token operator"},"=>"),l(),p("span",{class:"token punctuation"},"{"),l("\n    val "),p("span",{class:"token operator"},"="),l(" e"),p("span",{class:"token punctuation"},"."),l("target"),p("span",{class:"token punctuation"},"."),l("value"),p("span",{class:"token punctuation"},";"),l("\n  "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token boolean"},"false"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\n  btn"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"addEventListener"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'click'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"("),p("span",{class:"token parameter"},"e"),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token operator"},"=>"),l(),p("span",{class:"token punctuation"},"{"),l("\n    "),p("span",{class:"token function"},"fetch"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'http://localhost:8001/save'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"{"),l("\n      method"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'POST'"),p("span",{class:"token punctuation"},","),l("\n      body"),p("span",{class:"token operator"},":"),l(" val\n    "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n  "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token boolean"},"false"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n"),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("script"),p("span",{class:"token operator"},">"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br"),p("span",{class:"line-number"},"3"),p("br"),p("span",{class:"line-number"},"4"),p("br"),p("span",{class:"line-number"},"5"),p("br"),p("span",{class:"line-number"},"6"),p("br"),p("span",{class:"line-number"},"7"),p("br"),p("span",{class:"line-number"},"8"),p("br"),p("span",{class:"line-number"},"9"),p("br"),p("span",{class:"line-number"},"10"),p("br"),p("span",{class:"line-number"},"11"),p("br"),p("span",{class:"line-number"},"12"),p("br"),p("span",{class:"line-number"},"13"),p("br"),p("span",{class:"line-number"},"14"),p("br"),p("span",{class:"line-number"},"15"),p("br"),p("span",{class:"line-number"},"16"),p("br"),p("span",{class:"line-number"},"17"),p("br"),p("span",{class:"line-number"},"18"),p("br"),p("span",{class:"line-number"},"19"),p("br"),p("span",{class:"line-number"},"20"),p("br")])],-1),f=p("p",null,"启动一个 Node 服务监听 save 请求。为了简化，用一个变量来保存用户的输入：",-1),S=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token keyword"},"const"),l(" http "),p("span",{class:"token operator"},"="),l(),p("span",{class:"token function"},"require"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'http'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\n"),p("span",{class:"token keyword"},"let"),l(" userInput "),p("span",{class:"token operator"},"="),l(),p("span",{class:"token string"},"''"),p("span",{class:"token punctuation"},";"),l("\n\n"),p("span",{class:"token keyword"},"function"),l(),p("span",{class:"token function"},"handleReequest"),p("span",{class:"token punctuation"},"("),p("span",{class:"token parameter"},[l("req"),p("span",{class:"token punctuation"},","),l(" res")]),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token punctuation"},"{"),l("\n    "),p("span",{class:"token keyword"},"const"),l(" method "),p("span",{class:"token operator"},"="),l(" req"),p("span",{class:"token punctuation"},"."),l("method"),p("span",{class:"token punctuation"},";"),l("\n    res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"setHeader"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'Access-Control-Allow-Origin'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token string"},"'*'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n    res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"setHeader"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'Access-Control-Allow-Headers'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token string"},"'Content-Type'"),p("span",{class:"token punctuation"},")"),l("\n\n    "),p("span",{class:"token keyword"},"if"),l(),p("span",{class:"token punctuation"},"("),l("method "),p("span",{class:"token operator"},"==="),l(),p("span",{class:"token string"},"'POST'"),l(),p("span",{class:"token operator"},"&&"),l(" req"),p("span",{class:"token punctuation"},"."),l("url "),p("span",{class:"token operator"},"==="),l(),p("span",{class:"token string"},"'/save'"),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token punctuation"},"{"),l("\n        "),p("span",{class:"token keyword"},"let"),l(" body "),p("span",{class:"token operator"},"="),l(),p("span",{class:"token string"},"''"),p("span",{class:"token punctuation"},";"),l("\n        req"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"on"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'data'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token parameter"},"chunk"),l(),p("span",{class:"token operator"},"=>"),l(),p("span",{class:"token punctuation"},"{"),l("\n            body "),p("span",{class:"token operator"},"+="),l(" chunk"),p("span",{class:"token punctuation"},";"),l("\n        "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\n        req"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"on"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'end'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token operator"},"=>"),l(),p("span",{class:"token punctuation"},"{"),l("\n            "),p("span",{class:"token keyword"},"if"),l(),p("span",{class:"token punctuation"},"("),l("body"),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token punctuation"},"{"),l("\n                userInput "),p("span",{class:"token operator"},"="),l(" body"),p("span",{class:"token punctuation"},";"),l("\n            "),p("span",{class:"token punctuation"},"}"),l("\n            res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"end"),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n        "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n    "),p("span",{class:"token punctuation"},"}"),l(),p("span",{class:"token keyword"},"else"),l(),p("span",{class:"token punctuation"},"{"),l("\n        res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"writeHead"),p("span",{class:"token punctuation"},"("),p("span",{class:"token number"},"200"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"{"),p("span",{class:"token string"},"'Content-Type'"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'text/html; charset=UTF-8'"),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n        res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"write"),p("span",{class:"token punctuation"},"("),l("userInput"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n        res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"end"),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n    "),p("span",{class:"token punctuation"},"}"),l("\n"),p("span",{class:"token punctuation"},"}"),l("\n\n"),p("span",{class:"token keyword"},"const"),l(" server "),p("span",{class:"token operator"},"="),l(),p("span",{class:"token keyword"},"new"),l(),p("span",{class:"token class-name"},[l("http"),p("span",{class:"token punctuation"},"."),l("Server")]),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\nserver"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"listen"),p("span",{class:"token punctuation"},"("),p("span",{class:"token number"},"8001"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token string"},"'127.0.0.1'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\nserver"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"on"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'request'"),p("span",{class:"token punctuation"},","),l(" handleReequest"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br"),p("span",{class:"line-number"},"3"),p("br"),p("span",{class:"line-number"},"4"),p("br"),p("span",{class:"line-number"},"5"),p("br"),p("span",{class:"line-number"},"6"),p("br"),p("span",{class:"line-number"},"7"),p("br"),p("span",{class:"line-number"},"8"),p("br"),p("span",{class:"line-number"},"9"),p("br"),p("span",{class:"line-number"},"10"),p("br"),p("span",{class:"line-number"},"11"),p("br"),p("span",{class:"line-number"},"12"),p("br"),p("span",{class:"line-number"},"13"),p("br"),p("span",{class:"line-number"},"14"),p("br"),p("span",{class:"line-number"},"15"),p("br"),p("span",{class:"line-number"},"16"),p("br"),p("span",{class:"line-number"},"17"),p("br"),p("span",{class:"line-number"},"18"),p("br"),p("span",{class:"line-number"},"19"),p("br"),p("span",{class:"line-number"},"20"),p("br"),p("span",{class:"line-number"},"21"),p("br"),p("span",{class:"line-number"},"22"),p("br"),p("span",{class:"line-number"},"23"),p("br"),p("span",{class:"line-number"},"24"),p("br"),p("span",{class:"line-number"},"25"),p("br"),p("span",{class:"line-number"},"26"),p("br"),p("span",{class:"line-number"},"27"),p("br"),p("span",{class:"line-number"},"28"),p("br"),p("span",{class:"line-number"},"29"),p("br"),p("span",{class:"line-number"},"30"),p("br"),p("span",{class:"line-number"},"31"),p("br"),p("span",{class:"line-number"},"32"),p("br")])],-1),w=p("p",null,[l("当用户点击提交按钮将输入信息提交到服务端时，服务端通过 userInput 变量保存了输入内容。当用户通过 "),p("a",{href:"http://localhost:8001/$%7Bid%7D",target:"_blank",rel:"noopener noreferrer"},"http://localhost:8001/${id}"),l(" 访问时，服务端会返回与 id 对应的内容(本示例简化了处理)。如果用户输入了恶意脚本内容，则其他用户访问该内容时，恶意脚本就会在浏览器端执行：")],-1),C=p("h3",{id:"基于dom",tabindex:"-1"},[l("基于DOM "),p("a",{class:"header-anchor",href:"#基于dom","aria-hidden":"true"},"#")],-1),_=p("p",null,"基于 DOM 的 XSS 攻击是指通过恶意脚本修改页面的 DOM 结构，是纯粹发生在客户端的攻击。",-1),v=p("p",null,"看如下代码：",-1),y=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token operator"},"<"),l("h2"),p("span",{class:"token operator"},">"),p("span",{class:"token constant"},"XSS"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("h2"),p("span",{class:"token operator"},">"),l("\n"),p("span",{class:"token operator"},"<"),l("input type"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"text"'),l(" id"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"input"'),p("span",{class:"token operator"},">"),l("\n"),p("span",{class:"token operator"},"<"),l("button id"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"btn"'),p("span",{class:"token operator"},">"),l("Submit"),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("button"),p("span",{class:"token operator"},">"),l("\n"),p("span",{class:"token operator"},"<"),l("div id"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"div"'),p("span",{class:"token operator"},">"),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("div"),p("span",{class:"token operator"},">"),l("\n"),p("span",{class:"token operator"},"<"),l("script"),p("span",{class:"token operator"},">"),l("\n    "),p("span",{class:"token keyword"},"const"),l(" input "),p("span",{class:"token operator"},"="),l(" document"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"getElementById"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'input'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n    "),p("span",{class:"token keyword"},"const"),l(" btn "),p("span",{class:"token operator"},"="),l(" document"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"getElementById"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'btn'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n    "),p("span",{class:"token keyword"},"const"),l(" div "),p("span",{class:"token operator"},"="),l(" document"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"getElementById"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'div'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\n    "),p("span",{class:"token keyword"},"let"),l(" val"),p("span",{class:"token punctuation"},";"),l("\n\n    input"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"addEventListener"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'change'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"("),p("span",{class:"token parameter"},"e"),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token operator"},"=>"),l(),p("span",{class:"token punctuation"},"{"),l("\n        val "),p("span",{class:"token operator"},"="),l(" e"),p("span",{class:"token punctuation"},"."),l("target"),p("span",{class:"token punctuation"},"."),l("value"),p("span",{class:"token punctuation"},";"),l("\n    "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token boolean"},"false"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n\n    btn"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"addEventListener"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'click'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token operator"},"=>"),l(),p("span",{class:"token punctuation"},"{"),l("\n        div"),p("span",{class:"token punctuation"},"."),l("innerHTML "),p("span",{class:"token operator"},"="),l(),p("span",{class:"token template-string"},[p("span",{class:"token template-punctuation string"},"`"),p("span",{class:"token string"},"<a href="),p("span",{class:"token interpolation"},[p("span",{class:"token interpolation-punctuation punctuation"},"${"),l("val"),p("span",{class:"token interpolation-punctuation punctuation"},"}")]),p("span",{class:"token string"},">testLink</a>"),p("span",{class:"token template-punctuation string"},"`")]),l("\n    "),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token boolean"},"false"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n"),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("script"),p("span",{class:"token operator"},">"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br"),p("span",{class:"line-number"},"3"),p("br"),p("span",{class:"line-number"},"4"),p("br"),p("span",{class:"line-number"},"5"),p("br"),p("span",{class:"line-number"},"6"),p("br"),p("span",{class:"line-number"},"7"),p("br"),p("span",{class:"line-number"},"8"),p("br"),p("span",{class:"line-number"},"9"),p("br"),p("span",{class:"line-number"},"10"),p("br"),p("span",{class:"line-number"},"11"),p("br"),p("span",{class:"line-number"},"12"),p("br"),p("span",{class:"line-number"},"13"),p("br"),p("span",{class:"line-number"},"14"),p("br"),p("span",{class:"line-number"},"15"),p("br"),p("span",{class:"line-number"},"16"),p("br"),p("span",{class:"line-number"},"17"),p("br"),p("span",{class:"line-number"},"18"),p("br"),p("span",{class:"line-number"},"19"),p("br")])],-1),T=p("p",null,"点击 Submit 按钮后，会在当前页面插入一个链接，其地址为用户的输入内容。如果用户在输入时构造了如下内容：",-1),R=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token string"},"''"),l(" onclick"),p("span",{class:"token operator"},"="),p("span",{class:"token function"},"alert"),p("span",{class:"token punctuation"},"("),p("span",{class:"token regex"},[p("span",{class:"token regex-delimiter"},"/"),p("span",{class:"token regex-source language-regex"},"xss"),p("span",{class:"token regex-delimiter"},"/")]),p("span",{class:"token punctuation"},")"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br")])],-1),x=p("p",null,"用户提交之后，页面代码就变成了：",-1),A=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token operator"},"<"),l("a href onlick"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"alert(/xss/)"'),p("span",{class:"token operator"},">"),l("testLink"),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("a"),p("span",{class:"token operator"},">"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br")])],-1),F=o('',9),X=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token comment"},"// vuejs 中的 decodingMap"),l("\n"),p("span",{class:"token comment"},"// 在 vuejs 中，如果输入带 script 标签的内容，会直接过滤掉"),l("\n"),p("span",{class:"token keyword"},"const"),l(" decodingMap "),p("span",{class:"token operator"},"="),l(),p("span",{class:"token punctuation"},"{"),l("\n  "),p("span",{class:"token string"},"'&lt;'"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'<'"),p("span",{class:"token punctuation"},","),l("\n  "),p("span",{class:"token string"},"'&gt;'"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'>'"),p("span",{class:"token punctuation"},","),l("\n  "),p("span",{class:"token string"},"'&quot;'"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'\"'"),p("span",{class:"token punctuation"},","),l("\n  "),p("span",{class:"token string"},"'&amp;'"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'&'"),p("span",{class:"token punctuation"},","),l("\n  "),p("span",{class:"token string"},"'&#10;'"),p("span",{class:"token operator"},":"),l(),p("span",{class:"token string"},"'\\n'"),l("\n"),p("span",{class:"token punctuation"},"}"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br"),p("span",{class:"line-number"},"3"),p("br"),p("span",{class:"line-number"},"4"),p("br"),p("span",{class:"line-number"},"5"),p("br"),p("span",{class:"line-number"},"6"),p("br"),p("span",{class:"line-number"},"7"),p("br"),p("span",{class:"line-number"},"8"),p("br"),p("span",{class:"line-number"},"9"),p("br")])],-1),q=o('',11),H=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[l("es"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"setHeader"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'Set-Cookie'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"["),p("span",{class:"token string"},"'mycookie=222'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token string"},"'test=3333; expires=Sat, 21 Jul 2018 00:00:00 GMT;'"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br")])],-1),I=p("p",null,"上述代码创建了两个 Cookie：mycookie 和 test，前者属于会话期 Cookie，后者则属于持久性 Cookie。当我们去查看 Cookie 相关的属性时，不同的浏览器对会话期 Cookie 的 Expires 属性值会不一样：",-1),P=p("p",null,"此外，每个 Cookie 都会有与之关联的域，这个域的范围一般通过 donmain 属性指定。如果 Cookie 的域和页面的域相同，那么我们称这个 Cookie 为第一方 Cookie（first-party cookie），如果 Cookie 的域和页面的域不同，则称之为第三方 Cookie（third-party cookie）。一个页面包含图片或存放在其他域上的资源（如图片）时，第一方的 Cookie 也只会发送给设置它们的服务器。",-1),E=p("p",null,[l("通过 Cookie 进行 CSRF 攻击 假设有一个 bbs 站点："),p("a",{href:"http://www.c.com",target:"_blank",rel:"noopener noreferrer"},"http://www.c.com"),l("，当登录后的用户发起如下 GET 请求时，会删除 ID 指定的帖子：")],-1),M=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[l("http"),p("span",{class:"token operator"},":"),p("span",{class:"token operator"},"/"),p("span",{class:"token operator"},"/"),l("www"),p("span",{class:"token punctuation"},"."),l("c"),p("span",{class:"token punctuation"},"."),l("com"),p("span",{class:"token operator"},":"),p("span",{class:"token number"},"8002"),p("span",{class:"token operator"},"/"),l("content"),p("span",{class:"token operator"},"/"),p("span",{class:"token keyword"},"delete"),p("span",{class:"token operator"},"/"),p("span",{class:"token operator"},":"),l("id\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br")])],-1),O=p("p",null,[l("如发起 "),p("a",{href:"http://www.c.com:8002/content/delete/87343",target:"_blank",rel:"noopener noreferrer"},"http://www.c.com:8002/content/delete/87343"),l(" 请求时，会删除 id 为 87343 的帖子。当用户登录之后，会设置如下 cookie：")],-1),j=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[l("res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"setHeader"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'Set-Cookie'"),p("span",{class:"token punctuation"},","),l(),p("span",{class:"token punctuation"},"["),p("span",{class:"token string"},"'user=22333; expires=Sat, 21 Jul 2018 00:00:00 GMT;'"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br")])],-1),D=p("p",null,"user 对应的值是用户 ID。然后构造一个页面 A：",-1),L=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token operator"},"<"),l("p"),p("span",{class:"token operator"},">"),p("span",{class:"token constant"},"CSRF"),l(" 攻击者准备的网站："),p("span",{class:"token operator"},"<"),p("span",{class:"token operator"},"/"),l("p"),p("span",{class:"token operator"},">"),l("\n"),p("span",{class:"token operator"},"<"),l("img src"),p("span",{class:"token operator"},"="),p("span",{class:"token string"},'"http://www.c.com:8002/content/delete/87343"'),p("span",{class:"token operator"},">"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br")])],-1),V=o('',13),N=p("div",{class:"language-js line-numbers-mode"},[p("pre",null,[p("code",null,[p("span",{class:"token keyword"},"if"),l(),p("span",{class:"token punctuation"},"("),l("req"),p("span",{class:"token punctuation"},"."),l("headers"),p("span",{class:"token punctuation"},"."),l("referer "),p("span",{class:"token operator"},"!=="),l(),p("span",{class:"token string"},"'http://www.c.com:8002/'"),p("span",{class:"token punctuation"},")"),l(),p("span",{class:"token punctuation"},"{"),l("\n    res"),p("span",{class:"token punctuation"},"."),p("span",{class:"token function"},"write"),p("span",{class:"token punctuation"},"("),p("span",{class:"token string"},"'csrf 攻击'"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},";"),l("\n    "),p("span",{class:"token keyword"},"return"),p("span",{class:"token punctuation"},";"),l("\n"),p("span",{class:"token punctuation"},"}"),l("\n")])]),p("div",{class:"line-numbers-wrapper"},[p("span",{class:"line-number"},"1"),p("br"),p("span",{class:"line-number"},"2"),p("br"),p("span",{class:"line-number"},"3"),p("br"),p("span",{class:"line-number"},"4"),p("br")])],-1),B=o('',7);var J=n(i,[["render",function(n,o,p,l,r,i){const J=s("code-block");return c(),a("div",null,[u,e(J,{showAction:!1},{default:t((()=>[k])),_:1}),b,d,m,h,e(J,{showAction:!1},{default:t((()=>[g])),_:1}),f,e(J,{showAction:!1},{default:t((()=>[S])),_:1}),w,C,_,v,e(J,{showAction:!1},{default:t((()=>[y])),_:1}),T,e(J,{showAction:!1},{default:t((()=>[R])),_:1}),x,e(J,{showAction:!1},{default:t((()=>[A])),_:1}),F,e(J,{showAction:!1},{default:t((()=>[X])),_:1}),q,e(J,{showAction:!1},{default:t((()=>[H])),_:1}),I,P,E,e(J,{showAction:!1},{default:t((()=>[M])),_:1}),O,e(J,{showAction:!1},{default:t((()=>[j])),_:1}),D,e(J,{showAction:!1},{default:t((()=>[L])),_:1}),V,e(J,{showAction:!1},{default:t((()=>[N])),_:1}),B])}]]);export{r as __pageData,J as default};
