import{_ as n,r as s,c as a,a as t,w as e,f as o,e as c,b as p,o as l}from"./app.74c3daae.js";const u='{"title":"模拟实现Promise","description":"","frontmatter":{},"headers":[{"level":2,"title":"Promise/A+ 规范","slug":"promise-a-规范"},{"level":2,"title":"Promise API","slug":"promise-api"},{"level":2,"title":"Promise 实现基本原理","slug":"promise-实现基本原理"},{"level":3,"title":"safelyResolveThen","slug":"safelyresolvethen"},{"level":3,"title":"doResolve 和 doReject","slug":"doresolve-和-doreject"},{"level":3,"title":"Promise.prototype.then 和 Promise.prototype.catch","slug":"promise-prototype-then-和-promise-prototype-catch"},{"level":3,"title":"QueueItem","slug":"queueitem"},{"level":3,"title":"值穿透","slug":"值穿透"},{"level":3,"title":"Promise.resolve 和 Promise.reject","slug":"promise-resolve-和-promise-reject"},{"level":3,"title":"Promise.all","slug":"promise-all"},{"level":3,"title":"Promise.race","slug":"promise-race"},{"level":3,"title":"感受Promise","slug":"感受promise"}],"relativePath":"learns/javascript/promise.md","lastUpdated":1635388499005}',i={},r=o('',8),k=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token comment"},"// Promise 是一个构造函数，需要用 new 调用"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"resolver"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\n \n"),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"then"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"catch"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\n \nPromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"resolve"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\nPromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"reject"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\nPromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"all"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\nPromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"race"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br")])],-1),m=c("h2",{id:"promise-实现基本原理",tabindex:"-1"},[p("Promise 实现基本原理 "),c("a",{class:"header-anchor",href:"#promise-实现基本原理","aria-hidden":"true"},"#")],-1),b=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"resolve"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" a "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"onSuccess"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" b "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"onError"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'util'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"inspect"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token punctuation"},"{"),p(" depth"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"10"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},"."),p("queue"),c("span",{class:"token punctuation"},"["),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},"."),p("promise "),c("span",{class:"token operator"},"==="),p(" a"),c("span",{class:"token punctuation"},")"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},"."),p("queue"),c("span",{class:"token punctuation"},"["),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},"."),p("promise "),c("span",{class:"token operator"},"==="),p(" b"),c("span",{class:"token punctuation"},")"),p("\n\nPromise "),c("span",{class:"token punctuation"},"{"),p("\n  state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p("\n  value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p("\n  queue"),c("span",{class:"token operator"},":"),p("\n   "),c("span",{class:"token punctuation"},"["),p(" QueueItem "),c("span",{class:"token punctuation"},"{"),p("\n       promise"),c("span",{class:"token operator"},":"),p(" Promise "),c("span",{class:"token punctuation"},"{"),p(" state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p(" queue"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n       callFulfilled"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p("\n       callRejected"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n     QueueItem "),c("span",{class:"token punctuation"},"{"),p("\n       promise"),c("span",{class:"token operator"},":"),p(" Promise "),c("span",{class:"token punctuation"},"{"),p(" state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p(" queue"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n       callFulfilled"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p("\n       callRejected"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token boolean"},"true"),p("\n"),c("span",{class:"token boolean"},"true"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br")])],-1),d=c("p",null,"可以看出，queue 数组中有两个对象。因为规范中规定：then 方法可以被同一个 promise 调用多次。上例中在调用 .then 和 .catch 时 promise 并没有被 resolve，所以将 .then 和 .catch 生成的新 promise（a 和 b） 和正确时的回调（onSuccess 包装成 callFulfilled）和错误时的回调（onError 包装成 callRejected）生成一个 QueueItem 实例并 push 到 queue 数组里，所以上面两个 console.log 打印 true。当 promise 状态改变时遍历内部 queue 数组，统一执行成功（FULFILLED -> callFulfilled）或失败（REJECTED -> callRejected）的回调（传入 promise 的 value 值），生成的结果分别设置 a 和 b 的 state 和 value，这就是 Promise 实现的基本原理。",-1),f=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"resolve"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\npromise\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'util'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"inspect"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token punctuation"},"{"),p(" depth"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"10"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p("\n\nPromise "),c("span",{class:"token punctuation"},"{"),p("\n  state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p("\n  value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p("\n  queue"),c("span",{class:"token operator"},":"),p("\n   "),c("span",{class:"token punctuation"},"["),p(" QueueItem "),c("span",{class:"token punctuation"},"{"),p("\n       promise"),c("span",{class:"token operator"},":"),p("\n        Promise "),c("span",{class:"token punctuation"},"{"),p("\n          state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p("\n          value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p("\n          queue"),c("span",{class:"token operator"},":"),p("\n           "),c("span",{class:"token punctuation"},"["),p(" QueueItem "),c("span",{class:"token punctuation"},"{"),p("\n               promise"),c("span",{class:"token operator"},":"),p("\n                Promise "),c("span",{class:"token punctuation"},"{"),p("\n                  state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p("\n                  value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p("\n                  queue"),c("span",{class:"token operator"},":"),p("\n                   "),c("span",{class:"token punctuation"},"["),p(" QueueItem "),c("span",{class:"token punctuation"},"{"),p("\n                       promise"),c("span",{class:"token operator"},":"),p(" Promise "),c("span",{class:"token punctuation"},"{"),p(" state"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},","),p(" queue"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n                       callFulfilled"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p("\n                       callRejected"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n               callFulfilled"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p("\n               callRejected"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n       callFulfilled"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p("\n       callRejected"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"["),p("Function"),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br"),c("span",{class:"line-number"},"27"),c("br"),c("span",{class:"line-number"},"28"),c("br"),c("span",{class:"line-number"},"29"),c("br"),c("span",{class:"line-number"},"30"),c("br"),c("span",{class:"line-number"},"31"),c("br"),c("span",{class:"line-number"},"32"),c("br"),c("span",{class:"line-number"},"33"),c("br"),c("span",{class:"line-number"},"34"),c("br"),c("span",{class:"line-number"},"35"),c("br"),c("span",{class:"line-number"},"36"),c("br")])],-1),h=c("p",null,"调用了 3 次 then，每个 then 将它生成的 promise 放到了调用它的 promise 队列里，形成了 3 层调用关系。当最外层的 promise 状态改变时，遍历它的 queue 数组调用对应的回调，设置子 promise 的 state 和 value 并遍历它的 queue 数组调用对应的回调，然后设置孙 promise 的 state 和 value 并遍历它的 queue 数组调用对应的回调......依次类推。",-1),w=c("h3",{id:"safelyresolvethen",tabindex:"-1"},[p("safelyResolveThen "),c("a",{class:"header-anchor",href:"#safelyresolvethen","aria-hidden":"true"},"#")],-1),y=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"safelyResolveThen"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("self"),c("span",{class:"token punctuation"},","),p(" then")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"false"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"try"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        "),c("span",{class:"token keyword"},"return"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n      called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),p("self"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        "),c("span",{class:"token keyword"},"return"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n      called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("self"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token keyword"},"catch"),p(),c("span",{class:"token punctuation"},"("),p("error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"return"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n    called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("self"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br")])],-1),v=c("p",null,"safelyResolveThen 顾名思义用来『安全的执行 then 函数』，这里的 then 函数指『第一个参数是 resolve 函数第二个参数是 reject 函数的函数』，如下两种情况：",-1),g=c("ul",null,[c("li",null,"构造函数的参数，即这里的 resolver："),c("li",null,"promise 的 then")],-1),j=c("p",null,"safelyResolveThen 有 3 个作用：",-1),P=c("ul",null,[c("li",null,"try...catch 捕获抛出的异常，如：")],-1),R=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"resolver"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Error"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'Oops'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br")])],-1),E=c("ul",null,[c("li",null,"called 控制 resolve 或 reject 只执行一次，多次调用没有任何作用。")],-1),F=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"resolver"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token function"},"reject"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'error'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\npromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),p("console"),c("span",{class:"token punctuation"},"."),p("log"),c("span",{class:"token punctuation"},")"),p("\npromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),p("console"),c("span",{class:"token punctuation"},"."),p("error"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br")])],-1),A=c("p",null,"打印 error，不会再打印 haha。",-1),T=c("ul",null,[c("li",null,"没有错误则执行 doResolve，有错误则执行 doReject。")],-1),_=c("h3",{id:"doresolve-和-doreject",tabindex:"-1"},[p("doResolve 和 doReject "),c("a",{class:"header-anchor",href:"#doresolve-和-doreject","aria-hidden":"true"},"#")],-1),q=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("self"),c("span",{class:"token punctuation"},","),p(" value")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"try"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"var"),p(" then "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"getThen"),c("span",{class:"token punctuation"},"("),p("value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("then"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"safelyResolveThen"),c("span",{class:"token punctuation"},"("),p("self"),c("span",{class:"token punctuation"},","),p(" then"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token keyword"},"else"),p(),c("span",{class:"token punctuation"},"{"),p("\n      self"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token constant"},"FULFILLED"),c("span",{class:"token punctuation"},";"),p("\n      self"),c("span",{class:"token punctuation"},"."),p("value "),c("span",{class:"token operator"},"="),p(" value"),c("span",{class:"token punctuation"},";"),p("\n      self"),c("span",{class:"token punctuation"},"."),p("queue"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"forEach"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"queueItem"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        queueItem"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"callFulfilled"),c("span",{class:"token punctuation"},"("),p("value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token keyword"},"return"),p(" self"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token keyword"},"catch"),p(),c("span",{class:"token punctuation"},"("),p("error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("self"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n \n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("self"),c("span",{class:"token punctuation"},","),p(" error")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  self"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token constant"},"REJECTED"),c("span",{class:"token punctuation"},";"),p("\n  self"),c("span",{class:"token punctuation"},"."),p("value "),c("span",{class:"token operator"},"="),p(" error"),c("span",{class:"token punctuation"},";"),p("\n  self"),c("span",{class:"token punctuation"},"."),p("queue"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"forEach"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"queueItem"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    queueItem"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"callRejected"),c("span",{class:"token punctuation"},"("),p("error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"return"),p(" self"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br")])],-1),I=c("p",null,[p("doReject 就是设置 promise 的 state 为 REJECTED，value 为 error，callRejected 如前面提到的通知子 promise：『我这里出了点问题呀』然后子 promise 根据传入的错误设置自己的状态和值。"),c("code",null,"doResolve 结合 safelyResolveThen 使用不断地解包 promise，直至返回值是非 promise 对象"),p("后，设置 promise 的状态和值，然后通知子 promise：『我这里有值了哟』然后子 promise 根据传入的值设置自己的状态和值。")],-1),S=c("p",null,"这里有个辅助函数 getThen：",-1),L=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"getThen"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"obj"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" then "),c("span",{class:"token operator"},"="),p(" obj "),c("span",{class:"token operator"},"&&"),p(" obj"),c("span",{class:"token punctuation"},"."),p("then"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("obj "),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"isObject"),c("span",{class:"token punctuation"},"("),p("obj"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"||"),p(),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("obj"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("then"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"appyThen"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"apply"),c("span",{class:"token punctuation"},"("),p("obj"),c("span",{class:"token punctuation"},","),p(" arguments"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br")])],-1),D=c("p",null,"规范中规定：如果 then 是函数，将 x（这里是 obj） 作为函数的 this 调用。",-1),x=c("h3",{id:"promise-prototype-then-和-promise-prototype-catch",tabindex:"-1"},[p("Promise.prototype.then 和 Promise.prototype.catch "),c("a",{class:"header-anchor",href:"#promise-prototype-then-和-promise-prototype-catch","aria-hidden":"true"},"#")],-1),N=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("\n"),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"then"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("onFulfilled"),c("span",{class:"token punctuation"},","),p(" onRejected")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("onFulfilled"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token constant"},"FULFILLED"),p(),c("span",{class:"token operator"},"||"),p("\n    "),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("onRejected"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token constant"},"REJECTED"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},[p("this"),c("span",{class:"token punctuation"},"."),p("constructor")]),c("span",{class:"token punctuation"},"("),c("span",{class:"token constant"},"INTERNAL"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"!=="),p(),c("span",{class:"token constant"},"PENDING"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"var"),p(" resolver "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token constant"},"FULFILLED"),p(),c("span",{class:"token operator"},"?"),p(" onFulfilled "),c("span",{class:"token operator"},":"),p(" onRejected"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token function"},"unwrap"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" resolver"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token keyword"},"else"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("queue"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"push"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"QueueItem"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" onFulfilled"),c("span",{class:"token punctuation"},","),p(" onRejected"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"return"),p(" promise"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n \n"),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"catch"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"onRejected"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"null"),c("span",{class:"token punctuation"},","),p(" onRejected"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br")])],-1),C=c("p",null,"上述代码中的 return this 实现了值穿透，后面会讲。可以看出，then 方法中生成了一个新的 promise 然后返回，符合规范要求。如果 promise 的状态改变了，则调用 unwrap，否则将生成的 promise 加入到当前 promise 的回调队列 queue 里，之前讲解了如何消费 queue。有 3 点需要讲解：",-1),Q=c("ul",null,[c("li",null,"Promise 构造函数传入了一个 INTERNAL 即空函数，因为这个新产生的 promise 可以认为是内部的 promise，需要根据外部的 promise 的状态和值产生自身的状态和值，不需要传入回调函数，而外部 Promise 需要传入回调函数决定它的状态和值。所以之前 Promise 的构造函数里做了判断区分外部调用还是内部调用"),c("li",null,"unwrap 代码如下")],-1),U=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token comment"},"// 用来解包（即执行函数）的"),p("\n"),c("span",{class:"token comment"},"// 第一个参数是子 promise"),p("\n"),c("span",{class:"token comment"},"// 第二个参数是父 promise 的 then 的回调（onFulfilled/onRejected）"),p("\n"),c("span",{class:"token comment"},"// 第三个参数是父 promise 的值（正常值/错误）"),p("\n"),c("span",{class:"token comment"},"// 使用 setTimeout 将同步代码变异步"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"unwrap"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("promise"),c("span",{class:"token punctuation"},","),p(" callback"),c("span",{class:"token punctuation"},","),p(" value")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"let"),p(" res"),c("span",{class:"token punctuation"},";"),p("\n\n    "),c("span",{class:"token keyword"},"try"),p(),c("span",{class:"token punctuation"},"{"),p("\n      res "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"callback"),c("span",{class:"token punctuation"},"("),p("value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token keyword"},"catch"),p(),c("span",{class:"token punctuation"},"("),p("error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n\n    "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("promise "),c("span",{class:"token operator"},"==="),p(" res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"TypeError"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'Cannot resolve promise with itself'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" res"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br")])],-1),H=c("p",null,"使用 immediate 将同步代码变异步",-1),J=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\npromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'1'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'2'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br")])],-1),G=c("p",null,"打印 2 1，去掉 immediate 则打印 1 2。",-1),O=c("p",null,"try...catch 用来捕获 then/catch 内抛出的异常，并调用 doReject",-1),V=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Error"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\npromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Error"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br")])],-1),B=c("p",null,"返回的值不能是 promise 本身，否则会造成死循环，如 node@4.6.0 下运行",-1),z=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" a "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"return"),p(" a\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n\na"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),p("console"),c("span",{class:"token punctuation"},"."),p("log"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// [TypeError: Chaining cycle detected for promise #<Promise>]"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br")])],-1),K=c("h3",{id:"queueitem",tabindex:"-1"},[p("QueueItem "),c("a",{class:"header-anchor",href:"#queueitem","aria-hidden":"true"},"#")],-1),M=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"QueueItem"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("promise"),c("span",{class:"token punctuation"},","),p(" onFulfilled"),c("span",{class:"token punctuation"},","),p(" onRejected")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("promise "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"callFulfilled"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("promise"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"callRejected"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("promise"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("onFulfilled"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"callFulfilled"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"unwrap"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("promise"),c("span",{class:"token punctuation"},","),p(" onFulfilled"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("onRejected"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"callRejected"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"unwrap"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("promise"),c("span",{class:"token punctuation"},","),p(" onRejected"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br")])],-1),W=c("p",null,"promise 为 then 生成的新 promise（以下称为『子promise』），onFulfilled 和 onRejected 即是 then 参数中的 onFulfilled 和 onRejected。从上面代码可以看出：比如当 promise 状态变为 FULFILLED 时，之前注册的 then 函数，用 callFulfilled 调用 unwrap 进行解包最终得出子 promise 的状态和值，之前注册的 catch 函数，用 callFulfilled 直接调用 doResolve，设置队列里子 promise 的状态和值。当 promise 状态变为 REJECTED 类似。",-1),X=c("blockquote",null,[c("p",null,"promise.catch(onRejected) 就是 promise.then(null, onRejected) 的语法糖。")],-1),Y=c("h3",{id:"值穿透",tabindex:"-1"},[p("值穿透 "),c("a",{class:"header-anchor",href:"#值穿透","aria-hidden":"true"},"#")],-1),Z=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"then"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("onFulfilled"),c("span",{class:"token punctuation"},","),p(" onRejected")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("onFulfilled"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token constant"},"FULFILLED"),p(),c("span",{class:"token operator"},"||"),p("\n    "),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isFunction"),c("span",{class:"token punctuation"},"("),p("onRejected"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("state "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token constant"},"REJECTED"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token operator"},"..."),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br")])],-1),$=c("p",null,"例如",-1),nn=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\npromise\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'hehe'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),p("console"),c("span",{class:"token punctuation"},"."),p("log"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br")])],-1),sn=c("p",null,"最终打印 haha 而不是 hehe。",-1),an=c("p",null,"其实值穿透有两种情况：",-1),tn=c("ul",null,[c("li",null,"promise 已经是 FULFILLED/REJECTED 时，通过 return this 实现的值穿透")],-1),en=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"resolve"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\npromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token comment"},"// ①"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// haha"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n  promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token comment"},"// ②"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// haha"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"==="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// true"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"==="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"{"),p(" name"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token string"},"'nswbmw'"),p(),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// true"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br")])],-1),on=c("p",null,"上述代码①②处 promise 已经是 FULFILLED 了符合条件所以执行了 return this。注意：原生的 Promise 实现里并不是这样实现的，所以会打印两个 false。",-1),cn=c("ul",null,[c("li",null,"promise 是 PENDING 时，通过生成新的 promise 加入到父 promise 的 queue，父 promise 有值时调用 callFulfilled->doResolve 或 callRejected->doReject（因为 then/catch 传入的参数不是函数）设置子 promise 的状态和值为父 promise 的状态和值。")],-1),pn=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("\n"),c("span",{class:"token keyword"},"var"),p(" Promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"require"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'appoint'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"resolve"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" a "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\na"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// haha"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" b "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"catch"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\nb"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// haha"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("a "),c("span",{class:"token operator"},"==="),p(" b"),c("span",{class:"token punctuation"},")"),c("span",{class:"token comment"},"// false"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br")])],-1),ln=c("h3",{id:"promise-resolve-和-promise-reject",tabindex:"-1"},[p("Promise.resolve 和 Promise.reject "),c("a",{class:"header-anchor",href:"#promise-resolve-和-promise-reject","aria-hidden":"true"},"#")],-1),un=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("Promise"),c("span",{class:"token punctuation"},"."),p("resolve "),c("span",{class:"token operator"},"="),p(" resolve"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("value "),c("span",{class:"token keyword"},"instanceof"),p(),c("span",{class:"token class-name"},"this"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(" value"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"this"),c("span",{class:"token punctuation"},"("),c("span",{class:"token constant"},"INTERNAL"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n \nPromise"),c("span",{class:"token punctuation"},"."),p("reject "),c("span",{class:"token operator"},"="),p(" reject"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"reject"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"reason"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"this"),c("span",{class:"token punctuation"},"("),c("span",{class:"token constant"},"INTERNAL"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" reason"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br")])],-1),rn=c("p",null,"当 Promise.resolve 参数是一个 promise 时，直接返回该值。",-1),kn=c("h3",{id:"promise-all",tabindex:"-1"},[p("Promise.all "),c("a",{class:"header-anchor",href:"#promise-all","aria-hidden":"true"},"#")],-1),mn=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token comment"},"// Promise.all 用来并行执行多个 promise/值,当所有 promise/值执行完毕后或有一个发生错误时返回"),p("\n"),c("span",{class:"token comment"},"//  Promise.all 内部生成了一个新的 promise 返回。"),p("\n"),c("span",{class:"token comment"},"//  called 用来控制即使有多个 promise reject 也只有第一个生效。"),p("\n"),c("span",{class:"token comment"},"//  values 用来存储结果。"),p("\n"),c("span",{class:"token comment"},"//  当最后一个 promise 得出结果后，使用 doResolve(promise, values) 设置 promise 的 state 为 FULFILLED，value 为结果数组 values。"),p("\nPromiseFn"),c("span",{class:"token punctuation"},"."),p("all "),c("span",{class:"token operator"},"="),p(" all"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"all"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"promises"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isArray"),c("span",{class:"token punctuation"},"("),p("promises"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"TypeError"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'parameter must be a array'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n\n  "),c("span",{class:"token keyword"},"const"),p(" len "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),p("len"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n\n  "),c("span",{class:"token keyword"},"let"),p(" called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"false"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"let"),p(" resolved "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"let"),p(" i "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token operator"},"-"),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"const"),p(" self "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"const"),p(" values "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Array"),c("span",{class:"token punctuation"},"["),p("len"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"const"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"this"),c("span",{class:"token punctuation"},"("),p("noop"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n\n  "),c("span",{class:"token keyword"},"while"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"++"),p("i "),c("span",{class:"token operator"},"<"),p(" len"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"doAllResolver"),c("span",{class:"token punctuation"},"("),p("promises"),c("span",{class:"token punctuation"},"["),p("i"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p(" i"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n\n  "),c("span",{class:"token keyword"},"return"),p(" promise"),c("span",{class:"token punctuation"},";"),p("\n\n  "),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"doAllResolver"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("item"),c("span",{class:"token punctuation"},","),p(" index")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    self"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),p("item"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      values"),c("span",{class:"token punctuation"},"["),p("index"),c("span",{class:"token punctuation"},"]"),p(),c("span",{class:"token operator"},"="),p(" value"),c("span",{class:"token punctuation"},";"),p("\n\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"++"),p("resolved "),c("span",{class:"token operator"},">="),p(" len "),c("span",{class:"token operator"},"&&"),p(),c("span",{class:"token operator"},"!"),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n        "),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" values"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n        "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br"),c("span",{class:"line-number"},"27"),c("br"),c("span",{class:"line-number"},"28"),c("br"),c("span",{class:"line-number"},"29"),c("br"),c("span",{class:"line-number"},"30"),c("br"),c("span",{class:"line-number"},"31"),c("br"),c("span",{class:"line-number"},"32"),c("br"),c("span",{class:"line-number"},"33"),c("br"),c("span",{class:"line-number"},"34"),c("br"),c("span",{class:"line-number"},"35"),c("br"),c("span",{class:"line-number"},"36"),c("br"),c("span",{class:"line-number"},"37"),c("br"),c("span",{class:"line-number"},"38"),c("br"),c("span",{class:"line-number"},"39"),c("br"),c("span",{class:"line-number"},"40"),c("br"),c("span",{class:"line-number"},"41"),c("br"),c("span",{class:"line-number"},"42"),c("br"),c("span",{class:"line-number"},"43"),c("br"),c("span",{class:"line-number"},"44"),c("br"),c("span",{class:"line-number"},"45"),c("br")])],-1),bn=c("p",null,"Promise.all 用来并行执行多个 promise/值，当所有 promise/值执行完毕后或有一个发生错误时返回。可以看出：",-1),dn=c("ul",null,[c("li",null,"Promise.all 内部生成了一个新的 promise 返回。"),c("li",null,"called 用来控制即使有多个 promise reject 也只有第一个生效。"),c("li",null,"values 用来存储结果。"),c("li",null,"当最后一个 promise 得出结果后，使用 doResolve(promise, values) 设置 promise 的 state 为 FULFILLED，value 为结果数组 values。")],-1),fn=c("h3",{id:"promise-race",tabindex:"-1"},[p("Promise.race "),c("a",{class:"header-anchor",href:"#promise-race","aria-hidden":"true"},"#")],-1),hn=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token comment"},"// Promise.race 接受一个数组，当数组中有一个 resolve 或 reject 时返回。"),p("\n"),c("span",{class:"token comment"},"// 这里用 called 控制只要有任何一个 promise onFulfilled/onRejected 立即去设置 promise 的状态和值。"),p("\nPromiseFn"),c("span",{class:"token punctuation"},"."),p("race "),c("span",{class:"token operator"},"="),p(" race"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"race"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"promises"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isArray"),c("span",{class:"token punctuation"},"("),p("promises"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"TypeError"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'parameter must be a array'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n\n  "),c("span",{class:"token keyword"},"const"),p(" len "),c("span",{class:"token operator"},"="),p(" promise"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),p("len"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n\n  "),c("span",{class:"token keyword"},"let"),p(" called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"false"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"let"),p(" self "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"let"),p(" i "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token operator"},"-"),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"const"),p(" values "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Array"),c("span",{class:"token punctuation"},"("),p("len"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"const"),p(" promise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"this"),c("span",{class:"token punctuation"},"("),p("noop"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n\n  "),c("span",{class:"token keyword"},"while"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"++"),p("i "),c("span",{class:"token operator"},"<"),p(" len"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"doReacResolver"),c("span",{class:"token punctuation"},"("),p("promises"),c("span",{class:"token punctuation"},"["),p("i"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},","),p(" i"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n\n  "),c("span",{class:"token keyword"},"return"),p(" promise"),c("span",{class:"token punctuation"},";"),p("\n\n  "),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"doReacResolver"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"item"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    self"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),p("item"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n        "),c("span",{class:"token function"},"doResolve"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"error"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),p("called"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        called "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n        "),c("span",{class:"token function"},"doReject"),c("span",{class:"token punctuation"},"("),p("promise"),c("span",{class:"token punctuation"},","),p(" error"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br"),c("span",{class:"line-number"},"27"),c("br"),c("span",{class:"line-number"},"28"),c("br"),c("span",{class:"line-number"},"29"),c("br"),c("span",{class:"line-number"},"30"),c("br"),c("span",{class:"line-number"},"31"),c("br"),c("span",{class:"line-number"},"32"),c("br"),c("span",{class:"line-number"},"33"),c("br"),c("span",{class:"line-number"},"34"),c("br"),c("span",{class:"line-number"},"35"),c("br"),c("span",{class:"line-number"},"36"),c("br"),c("span",{class:"line-number"},"37"),c("br"),c("span",{class:"line-number"},"38"),c("br"),c("span",{class:"line-number"},"39"),c("br")])],-1),wn=c("p",null,"Promise.race 接受一个数组，当数组中有一个 resolve 或 reject 时返回。跟 Promise.all 代码相近，只不过这里用 called 控制只要有任何一个 promise onFulfilled/onRejected 立即去设置 promise 的状态和值。",-1),yn=c("p",null,"附最佳调试测试用例：",-1),vn=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"PromiseFn"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"resolve"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token comment"},"// // resolve(new PromiseFn(function (resolve) {"),p("\n  "),c("span",{class:"token comment"},"//   resolve(true);"),p("\n  "),c("span",{class:"token comment"},"// // }));"),p("\n  "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'haha'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"result"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'result:'"),c("span",{class:"token punctuation"},","),p(" result"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br")])],-1),gn=c("h3",{id:"感受promise",tabindex:"-1"},[p("感受Promise "),c("a",{class:"header-anchor",href:"#感受promise","aria-hidden":"true"},"#")],-1),jn=c("p",null,"我们假设 doSomething 耗时 1s，doSomethingElse 耗时 1.5s：",-1),Pn=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'something'"),c("span",{class:"token punctuation"},")"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1000"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n \n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Promise"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("resolve"),c("span",{class:"token punctuation"},","),p(" reject")]),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"setTimeout"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token function"},"resolve"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'somethingElse'"),c("span",{class:"token punctuation"},")"),p("\n    "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1500"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br")])],-1),Rn=c("ul",null,[c("li",null,"第一种情况：")],-1),En=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"time"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 1'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"=>"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"timeEnd"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 1'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n\n"),c("span",{class:"token comment"},"// somethingElse"),p("\n"),c("span",{class:"token comment"},"// case 1: 2509ms"),p("\n"),c("span",{class:"token comment"},"// 执行顺序为："),p("\n"),c("span",{class:"token comment"},"// 解释：正常的 Promise 用法。"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"|"),p("\n           "),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},"|"),p("\n                           "),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),p("somethingElse"),c("span",{class:"token punctuation"},")"),p("\n                           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},">"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br")])],-1),Fn=c("ul",null,[c("li",null,"第二种情况：")],-1),An=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"time"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 2'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"timeEnd"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 2'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token comment"},"// undefined"),p("\n"),c("span",{class:"token comment"},"// case 2: 1009ms"),p("\n"),c("span",{class:"token comment"},"// 执行顺序为："),p("\n"),c("span",{class:"token comment"},"// 解释：因为没有使用 return，doSomethingElse 在 doSomething 执行完后异步执行的。"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"|"),p("\n           "),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},"|"),p("\n           "),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"undefined"),c("span",{class:"token punctuation"},")"),p("\n           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},">"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br")])],-1),Tn=c("ul",null,[c("li",null,[c("ol",{start:"3"},[c("li",null,"第三种情况")])])],-1),_n=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"time"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 3'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"timeEnd"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 3'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token comment"},"// something"),p("\n"),c("span",{class:"token comment"},"// case 3: 1008ms"),p("\n"),c("span",{class:"token comment"},"// 执行顺序为："),p("\n"),c("span",{class:"token comment"},"// 而我们知道 then 需要接受一个函数，否则会值穿透，所以打印 something。"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"|"),p("\n"),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},"|"),p("\n           "),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),p("something"),c("span",{class:"token punctuation"},")"),p("\n           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},">"),p("\n"),c("span",{class:"token comment"},"// 上面代码相当于："),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"time"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 3'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" doSomethingPromise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token keyword"},"var"),p(" doSomethingElsePromise "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\ndoSomethingPromise"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),p("doSomethingElsePromise"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"timeEnd"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 3'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br")])],-1),qn=c("ul",null,[c("li",null,"第四种情况：")],-1),In=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"time"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 4'"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),p("doSomethingElse"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"then"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"res"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("res"),c("span",{class:"token punctuation"},")"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"timeEnd"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'case 4'"),c("span",{class:"token punctuation"},")"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token comment"},"// somethingElse"),p("\n"),c("span",{class:"token comment"},"// case 4: 2513ms"),p("\n"),c("span",{class:"token comment"},"// 执行顺序为："),p("\n"),c("span",{class:"token comment"},"// 解释：doSomethingElse 作为 then 参数传入不会发生值穿透，并返回一个 promise，所以会顺序执行。"),p("\n"),c("span",{class:"token function"},"doSomething"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p("\n"),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"|"),p("\n           "),c("span",{class:"token function"},"doSomethingElse"),c("span",{class:"token punctuation"},"("),p("something"),c("span",{class:"token punctuation"},")"),p("\n           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"--"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},"|"),p("\n                           "),c("span",{class:"token function"},"finalHandler"),c("span",{class:"token punctuation"},"("),p("somethingElse"),c("span",{class:"token punctuation"},")"),p("\n                           "),c("span",{class:"token operator"},"|"),c("span",{class:"token operator"},"-"),c("span",{class:"token operator"},">"),p("\n\n\n"),c("span",{class:"token punctuation"},"["),p("原文"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token function"},"："),c("span",{class:"token punctuation"},"("),p("https"),c("span",{class:"token operator"},":"),c("span",{class:"token operator"},"/"),c("span",{class:"token operator"},"/"),p("blog"),c("span",{class:"token punctuation"},"."),p("csdn"),c("span",{class:"token punctuation"},"."),p("net"),c("span",{class:"token operator"},"/"),p("shimodocs"),c("span",{class:"token operator"},"/"),p("article"),c("span",{class:"token operator"},"/"),p("details"),c("span",{class:"token operator"},"/"),c("span",{class:"token number"},"55100011"),c("span",{class:"token punctuation"},")"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br")])],-1);var Sn=n(i,[["render",function(n,o,c,p,u,i){const Sn=s("code-block");return l(),a("div",null,[r,t(Sn,{showAction:!1},{default:e((()=>[k])),_:1}),m,t(Sn,{showAction:!1},{default:e((()=>[b])),_:1}),d,t(Sn,{showAction:!1},{default:e((()=>[f])),_:1}),h,w,t(Sn,{showAction:!1},{default:e((()=>[y])),_:1}),v,g,j,P,t(Sn,{showAction:!1},{default:e((()=>[R])),_:1}),E,t(Sn,{showAction:!1},{default:e((()=>[F])),_:1}),A,T,_,t(Sn,{showAction:!1},{default:e((()=>[q])),_:1}),I,S,t(Sn,{showAction:!1},{default:e((()=>[L])),_:1}),D,x,t(Sn,{showAction:!1},{default:e((()=>[N])),_:1}),C,Q,t(Sn,{showAction:!1},{default:e((()=>[U])),_:1}),H,t(Sn,{showAction:!1},{default:e((()=>[J])),_:1}),G,O,t(Sn,{showAction:!1},{default:e((()=>[V])),_:1}),B,t(Sn,{showAction:!1},{default:e((()=>[z])),_:1}),K,t(Sn,{showAction:!1},{default:e((()=>[M])),_:1}),W,X,Y,t(Sn,{showAction:!1},{default:e((()=>[Z])),_:1}),$,t(Sn,{showAction:!1},{default:e((()=>[nn])),_:1}),sn,an,tn,t(Sn,{showAction:!1},{default:e((()=>[en])),_:1}),on,cn,t(Sn,{showAction:!1},{default:e((()=>[pn])),_:1}),ln,t(Sn,{showAction:!1},{default:e((()=>[un])),_:1}),rn,kn,t(Sn,{showAction:!1},{default:e((()=>[mn])),_:1}),bn,dn,fn,t(Sn,{showAction:!1},{default:e((()=>[hn])),_:1}),wn,yn,t(Sn,{showAction:!1},{default:e((()=>[vn])),_:1}),gn,jn,t(Sn,{showAction:!1},{default:e((()=>[Pn])),_:1}),Rn,t(Sn,{showAction:!1},{default:e((()=>[En])),_:1}),Fn,t(Sn,{showAction:!1},{default:e((()=>[An])),_:1}),Tn,t(Sn,{showAction:!1},{default:e((()=>[_n])),_:1}),qn,t(Sn,{showAction:!1},{default:e((()=>[In])),_:1})])}]]);export{u as __pageData,Sn as default};
