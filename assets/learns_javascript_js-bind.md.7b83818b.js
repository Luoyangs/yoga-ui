import{_ as n,r as s,c as a,a as t,w as o,f as e,e as c,b as p,o as l}from"./app.82084a0b.js";const u='{"title":"模拟实现JS的bind方法","description":"","frontmatter":{},"headers":[{"level":2,"title":"因此可以得出结论1：","slug":"因此可以得出结论1："},{"level":2,"title":"可以分析得出结论3：","slug":"可以分析得出结论3："}],"relativePath":"learns/javascript/js-bind.md","lastUpdated":1638452551944}',r={},i=e('<p><div class="table-of-contents"><ul><li><a href="#因此可以得出结论1：">因此可以得出结论1：</a></li><li><a href="#可以分析得出结论3：">可以分析得出结论3：</a></li></ul></div></p><h1 id="模拟实现js的bind方法" tabindex="-1">模拟实现JS的bind方法 <a class="header-anchor" href="#模拟实现js的bind方法" aria-hidden="true">#</a></h1><p>先看一下bind是什么?</p>',3),k=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" obj "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\nobj"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"typeof"),p(),c("span",{class:"token class-name"},"Function"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),p("bind"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// function"),p("\n"),c("span",{class:"token keyword"},"typeof"),p(),c("span",{class:"token class-name"},"Function"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("  "),c("span",{class:"token comment"},"// function"),p("\n"),c("span",{class:"token class-name"},"Function"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),p("bind"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},";"),p("  "),c("span",{class:"token comment"},"// bind"),p("\n"),c("span",{class:"token class-name"},"Function"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},";"),p("  "),c("span",{class:"token comment"},"// bound "),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"dir"),c("span",{class:"token punctuation"},"("),c("span",{class:"token class-name"},"Function"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 可以自行在浏览器控制台打印看看"),p("\n"),c("span",{class:"token comment"},"// f bound ()"),p("\n"),c("span",{class:"token comment"},"//    length: 0"),p("\n"),c("span",{class:"token comment"},'//    name: "bound "'),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br")])],-1),b=c("h2",{id:"因此可以得出结论1：",tabindex:"-1"},[p("因此可以得出结论1： "),c("a",{class:"header-anchor",href:"#因此可以得出结论1：","aria-hidden":"true"},"#")],-1),m=c("p",null,[p("1、bind是Functoin原型链中Function.prototype的一个属性，每个函数都可以调用它。"),c("br"),p(" 2、bind本身是一个函数名为bind的函数，返回值也是函数，函数名是bound 。（打出来就是bound加上一个空格）。 知道了bind是函数，就可以传参，而且返回值'bound '也是函数，也可以传参，就很容易写出例子2：")],-1),d=c("p",null,"后文统一 bound 指原函数original bind之后返回的函数，便于说明。",-1),y=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" obj "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token punctuation"},"{"),p("\n  name"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token string"},"'test'"),c("span",{class:"token punctuation"},","),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"original"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("a"),c("span",{class:"token punctuation"},","),p(" b")]),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"["),p("a"),c("span",{class:"token punctuation"},","),p(" b"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token boolean"},"false"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token keyword"},"var"),p(" bound "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"original"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),p("obj"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" boundResult "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"bound"),c("span",{class:"token punctuation"},"("),c("span",{class:"token number"},"2"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 'test', [1, 2]"),p("\nboundResult"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// false"),p("\noriginal"),c("span",{class:"token punctuation"},"."),p("bind"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 'bind'"),p("\noriginal"),c("span",{class:"token punctuation"},"."),p("bind"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 1"),p("\n"),c("span",{class:"token function"},"original"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 2 返回original函数的形参个数"),p("\nbound"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 'bound original'"),p("\n"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 'bound '"),p("\n"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 0"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br")])],-1),f=c("p",null,"由此可以得出结论2： 1、调用bind的函数中的this指向bind()函数的第一个参数。",-1),w=c("p",null,"2、传给bind()的其他参数接收处理了，bind()之后返回的函数的参数也接收处理了，也就是说合并处理了。",-1),g=c("p",null,"3、并且bind()后的name为bound + 空格 + 调用bind的函数名。如果是匿名函数则是bound + 空格。",-1),h=c("p",null,"4、bind后的返回值函数，执行后返回值是原函数（original）的返回值。",-1),v=c("p",null,"5、bind函数形参（即函数的length）是1。bind后返回的bound函数形参不定，根据绑定的函数原函数（original）形参个数确定。",-1),A=c("p",null,"根据结论2：我们就可以简单模拟实现一个简版bindFn",-1),j=c("div",{class:"language-"},[c("pre",null,[c("code",null,"// 第一版 修改this指向，合并参数\nFunction.prototype.bindFn = function bind(thisArg){\n  if(typeof this !== 'function'){\n    throw new TypeError(this + 'must be a function');\n  }\n  // 存储函数本身\n  var self = this;\n  // 去除thisArg的其他参数 转成数组\n  var args = [].slice.call(arguments, 1);\n  var bound = function(){\n    // bind返回的函数 的参数转成数组\n    var boundArgs = [].slice.call(arguments);\n    // apply修改this指向，把两个函数的参数合并传给self函数，并执行self函数，返回执行结果\n    return self.apply(thisArg, args.concat(boundArgs));\n  }\n  return bound;\n}\n// 测试\nvar obj = {\n  name: 'test',\n};\nfunction original(a, b){\n  console.log(this.name);\n  console.log([a, b]);\n}\nvar bound = original.bindFn(obj, 1);\nbound(2); // 'test', [1, 2]\nbound.name; // 'bound' ?这一点怎么实现呢\n")]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br"),c("span",{class:"line-number"},"27"),c("br"),c("span",{class:"line-number"},"28"),c("br")])],-1),_=c("p",null,"我们知道函数是可以用new来实例化的。那么bind()返回值函数会是什么表现呢",-1),F=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" obj "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token punctuation"},"{"),p("\n  name"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token string"},"'轩辕Rowboat'"),c("span",{class:"token punctuation"},","),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"original"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},[p("a"),c("span",{class:"token punctuation"},","),p(" b")]),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'this'"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// original {}"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'typeof this'"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"typeof"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// object"),p("\n  "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("name "),c("span",{class:"token operator"},"="),p(" b"),c("span",{class:"token punctuation"},";"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'name'"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 2"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'this'"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("  "),c("span",{class:"token comment"},"// original {name: 2}"),p("\n  console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},"["),p("a"),c("span",{class:"token punctuation"},","),p(" b"),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 1, 2"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token keyword"},"var"),p(" bound "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"original"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),p("obj"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" newBoundResult "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"bound"),c("span",{class:"token punctuation"},"("),c("span",{class:"token number"},"2"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("newBoundResult"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'newBoundResult'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// original {name: 2} this指向了new bound()生成的新对象。"),p("\n\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br")])],-1),S=c("h2",{id:"可以分析得出结论3：",tabindex:"-1"},[p("可以分析得出结论3： "),c("a",{class:"header-anchor",href:"#可以分析得出结论3：","aria-hidden":"true"},"#")],-1),E=c("p",null,"1、bind原先指向obj的失效了，其他参数有效。",-1),P=c("p",null,"2、new bound的返回值是以original原函数构造器生成的新对象。original原函数的this指向的就是这个新对象,new做了什么?",-1),O=c("div",{class:"language-"},[c("pre",null,[c("code",null,"1.创建了一个全新的对象。<br/>\n2.这个对象会被执行[[Prototype]]（也就是__proto__）链接。<br/>\n3.生成的新对象会绑定到函数调用的this。<br/>\n4.通过new创建的每个对象将最终被[[Prototype]]链接到这个函数的prototype对象上。<br/>\n5.如果函数没有返回对象类型Object(包含Functoin, Array, Date, RegExg, Error)，那么new表达式中的函数调用会自动返回这个新的对象。\n")]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br")])],-1),R=c("p",null,"所以相当于new调用时，bind的返回值函数bound内部要模拟实现new实现的操作。",-1),$=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token comment"},"// 第三版 实现new调用"),p("\n"),c("span",{class:"token class-name"},"Function"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"bindFn"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"thisArg"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"typeof"),p(),c("span",{class:"token keyword"},"this"),p(),c("span",{class:"token operator"},"!=="),p(),c("span",{class:"token string"},"'function'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"TypeError"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),p(),c("span",{class:"token operator"},"+"),p(),c("span",{class:"token string"},"' must be a function'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token comment"},"// 存储调用bind的函数本身"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" self "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token comment"},"// 去除thisArg的其他参数 转成数组"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" args "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"slice"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("arguments"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"var"),p(),c("span",{class:"token function-variable function"},"bound"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token comment"},"// bind返回的函数 的参数转成数组"),p("\n    "),c("span",{class:"token keyword"},"var"),p(" boundArgs "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"slice"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("arguments"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token keyword"},"var"),p(" finalArgs "),c("span",{class:"token operator"},"="),p(" args"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"concat"),c("span",{class:"token punctuation"},"("),p("boundArgs"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token comment"},"// new 调用时，其实this instanceof bound判断也不是很准确。es6 new.target就是解决这一问题的。"),p("\n    "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),p(),c("span",{class:"token keyword"},"instanceof"),p(),c("span",{class:"token class-name"},"bound"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token comment"},"// 这里是实现上文描述的 new 的第 1, 2, 4 步"),p("\n      "),c("span",{class:"token comment"},"// 1.创建一个全新的对象"),p("\n      "),c("span",{class:"token comment"},"// 2.并且执行[[Prototype]]链接"),p("\n      "),c("span",{class:"token comment"},"// 4.通过`new`创建的每个对象将最终被`[[Prototype]]`链接到这个函数的`prototype`对象上。"),p("\n      "),c("span",{class:"token comment"},"// self可能是ES6的箭头函数，没有prototype，所以就没必要再指向做prototype操作。"),p("\n      "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),p("self"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n        "),c("span",{class:"token comment"},"// ES5 提供的方案 Object.create()"),p("\n        "),c("span",{class:"token comment"},"// bound.prototype = Object.create(self.prototype);"),p("\n        "),c("span",{class:"token comment"},"// 但 既然是模拟ES5的bind，那浏览器也基本没有实现Object.create()"),p("\n        "),c("span",{class:"token comment"},"// 所以采用 MDN ployfill方案 https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create"),p("\n        "),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"Empty"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),p("\n        "),c("span",{class:"token class-name"},"Empty"),c("span",{class:"token punctuation"},"."),p("prototype "),c("span",{class:"token operator"},"="),p(" self"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},";"),p("\n        bound"),c("span",{class:"token punctuation"},"."),p("prototype "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Empty"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n      "),c("span",{class:"token comment"},"// 这里是实现上文描述的 new 的第 3 步"),p("\n      "),c("span",{class:"token comment"},"// 3.生成的新对象会绑定到函数调用的`this`。"),p("\n      "),c("span",{class:"token keyword"},"var"),p(" result "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"self"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"apply"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},","),p(" finalArgs"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token comment"},"// 这里是实现上文描述的 new 的第 5 步"),p("\n      "),c("span",{class:"token comment"},"// 5.如果函数没有返回对象类型`Object`(包含`Functoin`, `Array`, `Date`, `RegExg`, `Error`)，"),p("\n      "),c("span",{class:"token comment"},"// 那么`new`表达式中的函数调用会自动返回这个新的对象。"),p("\n      "),c("span",{class:"token keyword"},"var"),p(" isObject "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"typeof"),p(" result "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token string"},"'object'"),p(),c("span",{class:"token operator"},"&&"),p(" result "),c("span",{class:"token operator"},"!=="),p(),c("span",{class:"token keyword"},"null"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token keyword"},"var"),p(" isFunction "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"typeof"),p(" result "),c("span",{class:"token operator"},"==="),p(),c("span",{class:"token string"},"'function'"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),p("isObject "),c("span",{class:"token operator"},"||"),p(" isFunction"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n        "),c("span",{class:"token keyword"},"return"),p(" result"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n      "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token keyword"},"else"),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token comment"},"// apply修改this指向，把两个函数的参数合并传给self函数，并执行self函数，返回执行结果"),p("\n      "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"self"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"apply"),c("span",{class:"token punctuation"},"("),p("thisArg"),c("span",{class:"token punctuation"},","),p(" finalArgs"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"return"),p(" bound"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br"),c("span",{class:"line-number"},"27"),c("br"),c("span",{class:"line-number"},"28"),c("br"),c("span",{class:"line-number"},"29"),c("br"),c("span",{class:"line-number"},"30"),c("br"),c("span",{class:"line-number"},"31"),c("br"),c("span",{class:"line-number"},"32"),c("br"),c("span",{class:"line-number"},"33"),c("br"),c("span",{class:"line-number"},"34"),c("br"),c("span",{class:"line-number"},"35"),c("br"),c("span",{class:"line-number"},"36"),c("br"),c("span",{class:"line-number"},"37"),c("br"),c("span",{class:"line-number"},"38"),c("br"),c("span",{class:"line-number"},"39"),c("br"),c("span",{class:"line-number"},"40"),c("br"),c("span",{class:"line-number"},"41"),c("br"),c("span",{class:"line-number"},"42"),c("br"),c("span",{class:"line-number"},"43"),c("br"),c("span",{class:"line-number"},"44"),c("br"),c("span",{class:"line-number"},"45"),c("br"),c("span",{class:"line-number"},"46"),c("br"),c("span",{class:"line-number"},"47"),c("br"),c("span",{class:"line-number"},"48"),c("br"),c("span",{class:"line-number"},"49"),c("br")])],-1),x=c("p",null,"注释中提到this instanceof bound也不是很准确，ES6 new.target很好的解决这一问题",-1),T=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"Student"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"name"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),p(),c("span",{class:"token keyword"},"instanceof"),p(),c("span",{class:"token class-name"},"Student"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("name "),c("span",{class:"token operator"},"="),p(" name"),c("span",{class:"token punctuation"},";"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'name'"),c("span",{class:"token punctuation"},","),p(" name"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"else"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Error"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'必须通过new关键字来调用Student。'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token keyword"},"var"),p(" student "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Student"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'轩辕'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" notAStudent "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"Student"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("student"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'Rowboat'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 不抛出错误，且执行了。"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("student"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'student'"),c("span",{class:"token punctuation"},","),p(" notAStudent"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'notAStudent'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n\n"),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"Student2"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"name"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"typeof"),p(),c("span",{class:"token keyword"},"new"),c("span",{class:"token punctuation"},"."),p("target "),c("span",{class:"token operator"},"!=="),p(),c("span",{class:"token string"},"'undefined'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},"."),p("name "),c("span",{class:"token operator"},"="),p(" name"),c("span",{class:"token punctuation"},";"),p("\n    console"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'name'"),c("span",{class:"token punctuation"},","),p(" name"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"else"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Error"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'必须通过new关键字来调用Student2。'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token keyword"},"var"),p(" student2 "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Student2"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'轩辕'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" notAStudent2 "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"Student2"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("student2"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'Rowboat'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\nconsole"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"log"),c("span",{class:"token punctuation"},"("),p("student2"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'student2'"),c("span",{class:"token punctuation"},","),p(" notAStudent2"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'notAStudent2'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p(),c("span",{class:"token comment"},"// 抛出错误"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br")])],-1),C=c("p",null,"细心的同学可能会发现了这版本的代码没有实现bind后的bound函数的nameMDN Function.name和lengthMDN Function.length",-1),D=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[p("Object"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"defineProperties"),c("span",{class:"token punctuation"},"("),p("bound"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token string"},"'length'"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"{"),p("\n    value"),c("span",{class:"token operator"},":"),p(" self"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},","),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},","),p("\n  "),c("span",{class:"token string"},"'name'"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token punctuation"},"{"),p("\n    value"),c("span",{class:"token operator"},":"),p(),c("span",{class:"token string"},"'bound '"),p(),c("span",{class:"token operator"},"+"),p(" self"),c("span",{class:"token punctuation"},"."),p("name"),c("span",{class:"token punctuation"},","),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br")])],-1),N=c("p",null,"最后es5-shim的源码实现bind，直接附上源码（有删减注释和部分修改等）",-1),M=c("div",{class:"language-js line-numbers-mode"},[c("pre",null,[c("code",null,[c("span",{class:"token keyword"},"var"),p(" $Array "),c("span",{class:"token operator"},"="),p(" Array"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" ArrayPrototype "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token class-name"},"$Array"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" $Object "),c("span",{class:"token operator"},"="),p(" Object"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" array_push "),c("span",{class:"token operator"},"="),p(" ArrayPrototype"),c("span",{class:"token punctuation"},"."),p("push"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" array_slice "),c("span",{class:"token operator"},"="),p(" ArrayPrototype"),c("span",{class:"token punctuation"},"."),p("slice"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" array_join "),c("span",{class:"token operator"},"="),p(" ArrayPrototype"),c("span",{class:"token punctuation"},"."),p("join"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" array_concat "),c("span",{class:"token operator"},"="),p(" ArrayPrototype"),c("span",{class:"token punctuation"},"."),p("concat"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" $Function "),c("span",{class:"token operator"},"="),p(" Function"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" FunctionPrototype "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token class-name"},"$Function"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" apply "),c("span",{class:"token operator"},"="),p(" FunctionPrototype"),c("span",{class:"token punctuation"},"."),p("apply"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(" max "),c("span",{class:"token operator"},"="),p(" Math"),c("span",{class:"token punctuation"},"."),p("max"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token comment"},"// 简版 源码更复杂些。"),p("\n"),c("span",{class:"token keyword"},"var"),p(),c("span",{class:"token function-variable function"},"isCallable"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"isCallable"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"value"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"if"),c("span",{class:"token punctuation"},"("),c("span",{class:"token class-name"},"Object"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"toString"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("value"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"!=="),p(),c("span",{class:"token string"},"'[Object Function]'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token boolean"},"false"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n    "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token boolean"},"true"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token keyword"},"var"),p(),c("span",{class:"token function-variable function"},"Empty"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"Empty"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token comment"},"// 源码是 defineProperties"),p("\n"),c("span",{class:"token comment"},"// 源码是bind笔者改成bindFn便于测试"),p("\nFunctionPrototype"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function-variable function"},"bindFn"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token function"},"bind"),c("span",{class:"token punctuation"},"("),c("span",{class:"token parameter"},"that"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" target "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token operator"},"!"),c("span",{class:"token function"},"isCallable"),c("span",{class:"token punctuation"},"("),p("target"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"throw"),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"TypeError"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'Function.prototype.bind called on incompatible '"),p(),c("span",{class:"token operator"},"+"),p(" target"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" args "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"array_slice"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("arguments"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token number"},"1"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" bound"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"var"),p(),c("span",{class:"token function-variable function"},"binder"),p(),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"function"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"this"),p(),c("span",{class:"token keyword"},"instanceof"),p(),c("span",{class:"token class-name"},"bound"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"var"),p(" result "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"apply"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("\n        target"),c("span",{class:"token punctuation"},","),p("\n        "),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},","),p("\n        "),c("span",{class:"token function"},"array_concat"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("args"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token function"},"array_slice"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("arguments"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p("\n      "),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token function"},"$Object"),c("span",{class:"token punctuation"},"("),p("result"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"==="),p(" result"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n        "),c("span",{class:"token keyword"},"return"),p(" result"),c("span",{class:"token punctuation"},";"),p("\n      "),c("span",{class:"token punctuation"},"}"),p("\n      "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token keyword"},"this"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p(),c("span",{class:"token keyword"},"else"),p(),c("span",{class:"token punctuation"},"{"),p("\n      "),c("span",{class:"token keyword"},"return"),p(),c("span",{class:"token function"},"apply"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("\n        target"),c("span",{class:"token punctuation"},","),p("\n        that"),c("span",{class:"token punctuation"},","),p("\n        "),c("span",{class:"token function"},"array_concat"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("args"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token function"},"array_slice"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("arguments"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},")"),p("\n      "),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" boundLength "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"max"),c("span",{class:"token punctuation"},"("),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},","),p(" target"),c("span",{class:"token punctuation"},"."),p("length "),c("span",{class:"token operator"},"-"),p(" args"),c("span",{class:"token punctuation"},"."),p("length"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"var"),p(" boundArgs "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token punctuation"},"["),c("span",{class:"token punctuation"},"]"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token keyword"},"for"),p(),c("span",{class:"token punctuation"},"("),c("span",{class:"token keyword"},"var"),p(" i "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token number"},"0"),c("span",{class:"token punctuation"},";"),p(" i "),c("span",{class:"token operator"},"<"),p(" boundLength"),c("span",{class:"token punctuation"},";"),p(" i"),c("span",{class:"token operator"},"++"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token function"},"array_push"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("boundArgs"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'$'"),p(),c("span",{class:"token operator"},"+"),p(" i"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token comment"},"// 这里是Function构造方式生成形参length $1, $2, $3..."),p("\n  bound "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token function"},"$Function"),c("span",{class:"token punctuation"},"("),c("span",{class:"token string"},"'binder'"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"'return function ('"),p(),c("span",{class:"token operator"},"+"),p(),c("span",{class:"token function"},"array_join"),c("span",{class:"token punctuation"},"."),c("span",{class:"token function"},"call"),c("span",{class:"token punctuation"},"("),p("boundArgs"),c("span",{class:"token punctuation"},","),p(),c("span",{class:"token string"},"','"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token operator"},"+"),p(),c("span",{class:"token string"},"'){ return binder.apply(this, arguments); }'"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},"("),p("binder"),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n\n  "),c("span",{class:"token keyword"},"if"),p(),c("span",{class:"token punctuation"},"("),p("target"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},")"),p(),c("span",{class:"token punctuation"},"{"),p("\n    "),c("span",{class:"token class-name"},"Empty"),c("span",{class:"token punctuation"},"."),p("prototype "),c("span",{class:"token operator"},"="),p(" target"),c("span",{class:"token punctuation"},"."),p("prototype"),c("span",{class:"token punctuation"},";"),p("\n    bound"),c("span",{class:"token punctuation"},"."),p("prototype "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"new"),p(),c("span",{class:"token class-name"},"Empty"),c("span",{class:"token punctuation"},"("),c("span",{class:"token punctuation"},")"),c("span",{class:"token punctuation"},";"),p("\n    "),c("span",{class:"token class-name"},"Empty"),c("span",{class:"token punctuation"},"."),p("prototype "),c("span",{class:"token operator"},"="),p(),c("span",{class:"token keyword"},"null"),c("span",{class:"token punctuation"},";"),p("\n  "),c("span",{class:"token punctuation"},"}"),p("\n  "),c("span",{class:"token keyword"},"return"),p(" bound"),c("span",{class:"token punctuation"},";"),p("\n"),c("span",{class:"token punctuation"},"}"),c("span",{class:"token punctuation"},";"),p("\n")])]),c("div",{class:"line-numbers-wrapper"},[c("span",{class:"line-number"},"1"),c("br"),c("span",{class:"line-number"},"2"),c("br"),c("span",{class:"line-number"},"3"),c("br"),c("span",{class:"line-number"},"4"),c("br"),c("span",{class:"line-number"},"5"),c("br"),c("span",{class:"line-number"},"6"),c("br"),c("span",{class:"line-number"},"7"),c("br"),c("span",{class:"line-number"},"8"),c("br"),c("span",{class:"line-number"},"9"),c("br"),c("span",{class:"line-number"},"10"),c("br"),c("span",{class:"line-number"},"11"),c("br"),c("span",{class:"line-number"},"12"),c("br"),c("span",{class:"line-number"},"13"),c("br"),c("span",{class:"line-number"},"14"),c("br"),c("span",{class:"line-number"},"15"),c("br"),c("span",{class:"line-number"},"16"),c("br"),c("span",{class:"line-number"},"17"),c("br"),c("span",{class:"line-number"},"18"),c("br"),c("span",{class:"line-number"},"19"),c("br"),c("span",{class:"line-number"},"20"),c("br"),c("span",{class:"line-number"},"21"),c("br"),c("span",{class:"line-number"},"22"),c("br"),c("span",{class:"line-number"},"23"),c("br"),c("span",{class:"line-number"},"24"),c("br"),c("span",{class:"line-number"},"25"),c("br"),c("span",{class:"line-number"},"26"),c("br"),c("span",{class:"line-number"},"27"),c("br"),c("span",{class:"line-number"},"28"),c("br"),c("span",{class:"line-number"},"29"),c("br"),c("span",{class:"line-number"},"30"),c("br"),c("span",{class:"line-number"},"31"),c("br"),c("span",{class:"line-number"},"32"),c("br"),c("span",{class:"line-number"},"33"),c("br"),c("span",{class:"line-number"},"34"),c("br"),c("span",{class:"line-number"},"35"),c("br"),c("span",{class:"line-number"},"36"),c("br"),c("span",{class:"line-number"},"37"),c("br"),c("span",{class:"line-number"},"38"),c("br"),c("span",{class:"line-number"},"39"),c("br"),c("span",{class:"line-number"},"40"),c("br"),c("span",{class:"line-number"},"41"),c("br"),c("span",{class:"line-number"},"42"),c("br"),c("span",{class:"line-number"},"43"),c("br"),c("span",{class:"line-number"},"44"),c("br"),c("span",{class:"line-number"},"45"),c("br"),c("span",{class:"line-number"},"46"),c("br"),c("span",{class:"line-number"},"47"),c("br"),c("span",{class:"line-number"},"48"),c("br"),c("span",{class:"line-number"},"49"),c("br"),c("span",{class:"line-number"},"50"),c("br"),c("span",{class:"line-number"},"51"),c("br"),c("span",{class:"line-number"},"52"),c("br"),c("span",{class:"line-number"},"53"),c("br"),c("span",{class:"line-number"},"54"),c("br"),c("span",{class:"line-number"},"55"),c("br"),c("span",{class:"line-number"},"56"),c("br"),c("span",{class:"line-number"},"57"),c("br"),c("span",{class:"line-number"},"58"),c("br"),c("span",{class:"line-number"},"59"),c("br"),c("span",{class:"line-number"},"60"),c("br"),c("span",{class:"line-number"},"61"),c("br"),c("span",{class:"line-number"},"62"),c("br")])],-1),B=c("p",null,[c("a",{href:"https://segmentfault.com/a/1190000017091983",target:"_blank",rel:"noopener noreferrer"},"原文")],-1);var J=n(r,[["render",function(n,e,c,p,u,r){const J=s("code-block");return l(),a("div",null,[i,t(J,{showAction:!1},{default:o((()=>[k])),_:1}),b,m,d,t(J,{showAction:!1},{default:o((()=>[y])),_:1}),f,w,g,h,v,A,t(J,{showAction:!1},{default:o((()=>[j])),_:1}),_,t(J,{showAction:!1},{default:o((()=>[F])),_:1}),S,E,P,t(J,{showAction:!1},{default:o((()=>[O])),_:1}),R,t(J,{showAction:!1},{default:o((()=>[$])),_:1}),x,t(J,{showAction:!1},{default:o((()=>[T])),_:1}),C,t(J,{showAction:!1},{default:o((()=>[D])),_:1}),N,t(J,{showAction:!1},{default:o((()=>[M])),_:1}),B])}]]);export{u as __pageData,J as default};
