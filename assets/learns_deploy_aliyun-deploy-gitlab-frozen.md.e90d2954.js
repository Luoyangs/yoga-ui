import{_ as a,r as s,c as l,a as e,w as n,f as p,e as r,b as i,o as t}from"./app.74c3daae.js";const u='{"title":"阿里云服务器搭建GItLab以后出现卡顿","description":"","frontmatter":{},"headers":[{"level":2,"title":"一、原因分析","slug":"一、原因分析"},{"level":2,"title":"二、解决方法","slug":"二、解决方法"},{"level":2,"title":"可能出现的问题","slug":"可能出现的问题"}],"relativePath":"learns/deploy/aliyun-deploy-gitlab-frozen.md","lastUpdated":1635388499005}',c={},d=p('<p><div class="table-of-contents"><ul><li><a href="#一、原因分析">一、原因分析</a></li><li><a href="#二、解决方法">二、解决方法</a></li><li><a href="#可能出现的问题">可能出现的问题</a></li></ul></div></p><h1 id="阿里云服务器搭建gitlab以后出现卡顿" tabindex="-1">阿里云服务器搭建GItLab以后出现卡顿 <a class="header-anchor" href="#阿里云服务器搭建gitlab以后出现卡顿" aria-hidden="true">#</a></h1><h2 id="一、原因分析" tabindex="-1">一、原因分析 <a class="header-anchor" href="#一、原因分析" aria-hidden="true">#</a></h2><p>最近索性自己用阿里云服务器搭建了一个 gitlab 服务器以供自己开发使用，服务器搭建很简单，但是使用起来是相当的卡顿，在代码 pull，push 过程中都会有相应的延迟，很糟心。起初我以为是我的阿里云服务器配置过低造成的（1核，2G，centos7），后来发现不是这样。</p><p>gitlab 启动运行就占用了大量的内存，2G内存在启动后已经所剩无几。想再进行 git 相关操作自然也就会出现卡顿现象。</p><p>正常 centos 应该是启用 swap 分区的，但是阿里云，腾讯云的服务器却没有swap分区！</p><p>通过以下命令查看swap分区情况：</p>',7),o=r("div",{class:"language-"},[r("pre",null,[r("code",null,"cat /proc/swaps\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br")])],-1),w=r("p",null,"结果并没有swap分区",-1),b=r("h2",{id:"二、解决方法",tabindex:"-1"},[i("二、解决方法 "),r("a",{class:"header-anchor",href:"#二、解决方法","aria-hidden":"true"},"#")],-1),h=r("p",null,"1、创建 swap 分区（这里需要等待几秒）",-1),m=r("div",{class:"language-"},[r("pre",null,[r("code",null,"dd if=/dev/zero of=/data/swap bs=512 count=8388616\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br")])],-1),f=r("p",null,"注意：创建swap大小为bs*count=4294971392(4G)，/data/swap目录若无则找/mnt/swap(我使用的是下面的指令生效)",-1),v=r("div",{class:"language-"},[r("pre",null,[r("code",null,"dd if=/dev/zero of=/mnt/swap bs=512 count=8388616\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br")])],-1),g=r("p",null,"2、通过mkswap命令将上面新建出的文件做成swap分区",-1),_=r("div",{class:"language-"},[r("pre",null,[r("code",null,"mkswap /mnt/swap\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br")])],-1),A=r("p",null,"3、查看内核参数vm.swappiness中的数值是否为0，如果为0则根据实际需要调整成60。查看参数：",-1),y=r("div",{class:"language-"},[r("pre",null,[r("code",null,"cat /proc/sys/vm/swappiness\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br")])],-1),T=r("p",null,"设置参数：",-1),x=r("div",{class:"language-"},[r("pre",null,[r("code",null,"sysctl -w vm.swappiness=60\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br")])],-1),G=r("p",null,"启用 swap 分区",-1),I=r("div",{class:"language-"},[r("pre",null,[r("code",null,"swapon /mnt/swap\necho “/mnt/swap swap swap defaults 0 0” >> /etc/fstab\n")]),r("div",{class:"line-numbers-wrapper"},[r("span",{class:"line-number"},"1"),r("br"),r("span",{class:"line-number"},"2"),r("br")])],-1),k=r("p",null,"5、再次使用cat /proc/swaps 查看swap分区是否启动。可以看到，swap分区已经启用，现在通过 gitlab 进行操作会发现很流畅！",-1),z=r("h2",{id:"可能出现的问题",tabindex:"-1"},[i("可能出现的问题 "),r("a",{class:"header-anchor",href:"#可能出现的问题","aria-hidden":"true"},"#")],-1),P=r("p",null,[i("当时可能gitlab运行没问题，后续的时候发现swap分区并未执行，可以试一下永久修改，则编辑"),r("code",null,"/etc/sysctl.conf"),i("文件，将vm.swappiness改为30或者60")],-1);var S=a(c,[["render",function(a,p,r,i,u,c){const S=s("code-block");return t(),l("div",null,[d,e(S,{showAction:!1},{default:n((()=>[o])),_:1}),w,b,h,e(S,{showAction:!1},{default:n((()=>[m])),_:1}),f,e(S,{showAction:!1},{default:n((()=>[v])),_:1}),g,e(S,{showAction:!1},{default:n((()=>[_])),_:1}),A,e(S,{showAction:!1},{default:n((()=>[y])),_:1}),T,e(S,{showAction:!1},{default:n((()=>[x])),_:1}),G,e(S,{showAction:!1},{default:n((()=>[I])),_:1}),k,z,P])}]]);export{u as __pageData,S as default};
